#!/bin/bash

# Output file
output="pokemon_report.csv"
echo "Name,Height (m),Weight (kg)" > "$output"

# Temporary file to collect data
temp_data="temp_pokemon_data.txt"
> "$temp_data"  # clear if it exists

# Loop through all JSON files
for file in pokemon_data/*.json; do
  name=$(jq -r '.name' "$file")
  height=$(jq -r '.height' "$file")
  weight=$(jq -r '.weight' "$file")

  # Convert to meters and kilograms using awk
  height_m=$(awk -v h="$height" 'BEGIN {printf "%.1f", h / 10}')
  weight_kg=$(awk -v w="$weight" 'BEGIN {printf "%.1f", w / 10}')

  # Append to CSV and temp file
  echo "$name,$height_m,$weight_kg" >> "$output"
  echo "$height_m $weight_kg" >> "$temp_data"
done

# Use awk to calculate averages from temp file
awk '
{
  total_height += $1
  total_weight += $2
  count += 1
}
END {
  avg_height = total_height / count
  avg_weight = total_weight / count
  printf "\nAverage Height: %.2f m\n", avg_height
  printf "Average Weight: %.2f kg\n", avg_weight
}
' "$temp_data"

# Clean up
rm -f "$temp_data"
