#!/bin/bash

# List of Pokémon
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Create output folder
mkdir -p pokemon_data

# Clear error log if it exists
> errors.log

# Loop through each Pokémon
for pokemon in "${pokemon_list[@]}"
do
  echo "Fetching data for $pokemon..."

  attempt=1
  success=false

  while [ $attempt -le 3 ]; do
    echo "Attempt $attempt for $pokemon..."

    # Try the API request and capture the HTTP status
    http_status=$(curl -s -w "%{http_code}" -o "pokemon_data/${pokemon}.json" "https://pokeapi.co/api/v2/pokemon/${pokemon}")

    if [ "$http_status" -eq 200 ]; then
      echo "✅ Success on attempt $attempt!"
      success=true
      break
    else
      echo "❌ Failed with status $http_status"
      attempt=$((attempt + 1))
      sleep 1  # wait before retrying
    fi
  done

  if [ "$success" = false ]; then
    echo "⚠️ Failed to fetch data for $pokemon after 3 attempts." | tee -a errors.log
    rm -f "pokemon_data/${pokemon}.json"  # remove incomplete file if created
  fi

  echo ""
done
